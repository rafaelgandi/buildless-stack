/* esm.sh - esbuild bundle(preact-router@4.1.2) es2022 production */
import{createContext as P,Component as D,toChildArray as A,cloneElement as K,h as g}from"./preact.js";
import{useContext as M,useState as S,useEffect as W}from"./hooks.js";
var j={};function l(t,e){for(var r in e)t[r]=e[r];return t}function w(t,e,r){var o,u=/(?:\?([^#]*))?(#.*)?$/,s=t.match(u),n={};if(s&&s[1])for(var f=s[1].split("&"),p=0;p<f.length;p++){var C=f[p].split("=");n[decodeURIComponent(C[0])]=decodeURIComponent(C.slice(1).join("="))}t=m(t.replace(u,"")),e=m(e||"");for(var E=Math.max(t.length,e.length),a=0;a<E;a++)if(e[a]&&e[a].charAt(0)===":"){var x=e[a].replace(/(^:|[+*?]+$)/g,""),d=(e[a].match(/[+*?]+$/)||j)[0]||"",k=~d.indexOf("+"),b=~d.indexOf("*"),R=t[a]||"";if(!R&&!b&&(d.indexOf("?")<0||k)){o=!1;break}if(n[x]=decodeURIComponent(R),k||b){n[x]=t.slice(a).map(decodeURIComponent).join("/");break}}else if(e[a]!==t[a]){o=!1;break}return(r.default===!0||o!==!1)&&n}function T(t,e){return t.rank<e.rank?1:t.rank>e.rank?-1:t.index-e.index}function N(t,e){return t.index=e,t.rank=function(r){return r.props.default?0:m(r.props.path).map(_).join("")}(t),t.props}function m(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function _(t){return t.charAt(0)==":"?1+"*+?".indexOf(t.charAt(t.length-1))||4:5}var q={},c=[],h=[],i=null,v={url:y()},I=P(v);function J(){var t=M(I);if(t===v){var e=S()[1];W(function(){return h.push(e),function(){return h.splice(h.indexOf(e),1)}},[])}return[t,L]}function y(){var t;return""+((t=i&&i.location?i.location:i&&i.getCurrentLocation?i.getCurrentLocation():typeof location<"u"?location:q).pathname||"")+(t.search||"")}function L(t,e){return e===void 0&&(e=!1),typeof t!="string"&&t.url&&(e=t.replace,t=t.url),function(r){for(var o=c.length;o--;)if(c[o].canRoute(r))return!0;return!1}(t)&&function(r,o){o===void 0&&(o="push"),i&&i[o]?i[o](r):typeof history<"u"&&history[o+"State"]&&history[o+"State"](null,null,r)}(t,e?"replace":"push"),O(t)}function O(t){for(var e=!1,r=0;r<c.length;r++)c[r].routeTo(t)&&(e=!0);return e}function z(t){if(t&&t.getAttribute){var e=t.getAttribute("href"),r=t.getAttribute("target");if(e&&e.match(/^\//g)&&(!r||r.match(/^_?self$/i)))return L(e)}}function B(t){return t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.stopPropagation&&t.stopPropagation(),t.preventDefault(),!1}function $(t){if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.button)){var e=t.target;do if(e.localName==="a"&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))return;if(z(e))return B(t)}while(e=e.parentNode)}}var U=!1;function F(t){t.history&&(i=t.history),this.state={url:t.url||y()}}l(F.prototype=new D,{shouldComponentUpdate:function(t){return t.static!==!0||t.url!==this.props.url||t.onChange!==this.props.onChange},canRoute:function(t){var e=A(this.props.children);return this.g(e,t)!==void 0},routeTo:function(t){this.setState({url:t});var e=this.canRoute(t);return this.p||this.forceUpdate(),e},componentWillMount:function(){this.p=!0},componentDidMount:function(){var t=this;U||(U=!0,i||addEventListener("popstate",function(){O(y())}),addEventListener("click",$)),c.push(this),i&&(this.u=i.listen(function(e){var r=e.location||e;t.routeTo(""+(r.pathname||"")+(r.search||""))})),this.p=!1},componentWillUnmount:function(){typeof this.u=="function"&&this.u(),c.splice(c.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(t,e){t=t.filter(N).sort(T);for(var r=0;r<t.length;r++){var o=t[r],u=w(e,o.props.path,o.props);if(u)return[o,u]}},render:function(t,e){var r,o,u=t.onChange,s=e.url,n=this.c,f=this.g(A(t.children),s);if(f&&(o=K(f[0],l(l({url:s,matches:r=f[1]},r),{key:void 0,ref:void 0}))),s!==(n&&n.url)){l(v,n=this.c={url:s,previous:n&&n.url,current:o,path:o?o.props.path:null,matches:r}),n.router=this,n.active=o?[o]:[];for(var p=h.length;p--;)h[p]({});typeof u=="function"&&u(n)}return g(I.Provider,{value:n},o)}});var Q=function(t){return g("a",l({onClick:$},t))},V=function(t){return g(t.component,t)};export{Q as Link,V as Route,F as Router,F as default,w as exec,y as getCurrentUrl,L as route,J as useRouter};
//# sourceMappingURL=preact-router.mjs.map